tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Timepoint",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of neutrophils in each group for each cluster (Blood)',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
Idents(combined) <- combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("all_cells_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
tmp_combined <- subset(combined, subset= Timepoint == "Preclinical")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("preclinical_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Tissue",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of cells in each group for each cluster',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
tmp_combined <- subset(combined, subset= Timepoint == "Preclinical")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("preclinical_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Tissue",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of cells in each group for each cluster',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each tissue by cluster (Preclinical time)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each tissue by cluster (Preclinical)',
x.reorder = new_ord
)
tmp_combined <- subset(combined, subset= Timepoint == "Onset")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("preclinical_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each tissue by cluster (Onset)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each tissue by cluster (Onset)',
x.reorder = new_ord
)
knitr::opts_chunk$set(echo = TRUE)
library(Seurat)
library(RColorBrewer)
library(Polychrome)
library(ggplot2)
suppressPackageStartupMessages(library(SCINA))
suppressPackageStartupMessages(library(preprocessCore))
library(stringr)
library(tidyverse)
library(fgsea)
library(enrichR)
library(DT)
library(cowplot)
library(clusterProfiler)
library(knitr)
#library(ggpubr)
#library(ggrepel)
#library(ggfortify)
#library(QUBIC)
#library(DESeq2)
#library(pheatmap)
#library(patchwork)
#library(monocle)
#library(DelayedArray)
#library(DelayedMatrixStats)
#library(org.Mm.eg.db)
#library(VennDiagram)
#
knitr::opts_knit$set(root.dir = "D:/Project/BISR/Segal_201230_Pearlly_GSL-PY-1958")
setwd("D:/Project/BISR/Segal_201230_Pearlly_GSL-PY-1958")
####
combined <- readRDS("combined.rds")
####
table(combined$Tissue)
tb_all <- table(combined$Tissue, combined$Timepoint)
table(combined$Timepoint)
tb_all
source("functions.R")
dbs <- c("GO_Molecular_Function_2018", "GO_Cellular_Component_2018", "GO_Biological_Process_2018","KEGG_2019_Mouse")
#DefaultAssay(combined) <- "integrated"
#combined <- FindClusters(combined, resolution = 0.2)
DefaultAssay(combined) <- "RNA"
custom_color <- as.character(palette36.colors(36)[-2])[1:length(levels(Idents(combined)))]
table(combined$seurat_clusters)
Plot.cluster2D(combined, pt_size = 0.4, txt = "Predicted cluster")
Idents(combined) <- combined$cellmarker_cell_type
print(Plot.cluster2D(combined, pt_size = 0.4, txt = "CellMarker cell type"))
Idents(combined) <- combined$scCATCH_cell_type2
print(Plot.cluster2D(combined, pt_size = 0.4, txt = "scCATCH cell type"))
tmp_combined <- subset(combined, subset= Tissue == "CNS")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p1 <- DimPlot(tmp_combined, reduction = "umap", split.by = "Timepoint", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("CNS_cluster_split_by_timepoint.png", sep = ""), width = 8000, height = 2000, res = 300)
p1
dev.off()
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Timepoint",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of cells in each group for each cluster (CNS)',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each timepoint by cluster (CNS)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each timepoint by cluster (CNS)',
x.reorder = new_ord
)
tmp_combined <- subset(combined, subset= Tissue == "Blood")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p1 <- DimPlot(tmp_combined, reduction = "umap", split.by = "Timepoint", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("Blood_cluster_split_by_timepoint.png", sep = ""), width = 8000, height = 2000, res = 300)
p1
dev.off()
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Timepoint",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of cells in each group for each cluster (Blood)',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Timepoint",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each timepoint by cluster (Blood)',
x.reorder = new_ord
)
Idents(combined) <- combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("all_cells_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
tmp_combined <- subset(combined, subset= Timepoint == "Preclinical")
Idents(tmp_combined) <- tmp_combined$seurat_clusters
p2 <- DimPlot(combined, reduction = "umap", split.by = "Tissue", cols =as.vector(palette36.colors(36)[-2]), pt.size = 0.7)
png(paste("preclinical_cluster_split_by_tissue.png", sep = ""), width = 4000, height = 2000, res = 500)
p2
dev.off()
library(dittoSeq)
Idents(tmp_combined) <- tmp_combined$seurat_clusters
count_table <- dittoBarPlot(tmp_combined, "seurat_clusters", group.by = "Tissue",xlab = "Group",scale ="percent",color.panel =custom_color, main = 'Percent of cells in each group for each cluster',data.out = T)$data
colnames(count_table)[5] <- 'Percent of cell in the group'
DT::datatable(count_table[,-4], options= list(order = list(1, 'asc')))
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral"),
main = 'Number of cells in each tissue by cluster (Preclinical)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "percent",
color.panel = brewer.pal(4, "Spectral"),
main = 'Percent of cells in each tissue by cluster (Preclinical)',
x.reorder = new_ord
)
brewer.pal(4, "Spectral")
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral")[1,4,2,3],
main = 'Number of cells in each tissue by cluster (Preclinical)',
x.reorder = new_ord
)
new_ord <- order(order(levels(as.factor(
tmp_combined$seurat_clusters
))))
dittoBarPlot(
tmp_combined,
"Tissue",
group.by = "seurat_clusters",
xlab = "Group",
scale = "count",
color.panel = brewer.pal(4, "Spectral")[c(1,4,2,3)],
main = 'Number of cells in each tissue by cluster (Preclinical)',
x.reorder = new_ord
)
Sys.setenv(RETICULATE_PYTHON = "C:/Users/flyku/anaconda3/python.exe")
library(arrow)
library(reticulate)
library(feather)
py_config()
a1 <- use_virtualenv("arrow-env")
virtualenv_create("arrow-env")
py_config()
virtualenv_remove("arrow-env")
y
virtualenv_create("arrow-env")
install_pyarrow("arrow-env")
a1
install_pyarrow
reticulate::py_install("pyarrow", envname = "arrow-env")
conda_install(envname = 'arrow-env', c('pyarrow'), pip = F)
use_virtualenv("arrow-env")
Sys.which("python"))
Sys.which("python")
#Sys.which("python")
use_virtualenv("myenv")
#Sys.which("python")
use_virtualenv("mye321nv")
conda_create("arrow-env")
use_virtualenv("arrow-env")
conda_install(envname="arrow-env", packages ="pyarrow")
use_miniconda("arrow-env", required=T)
library(arrow)
library(reticulate)
library(arrow)
use_miniconda("arrow-env", required=T)
Sys.which("python")
demo_server <- arrow::load_flight_server("demo_flight_server")
reticulate::py_install("pyarrow", envname = "arrow-env")
conda_install(envname = 'arrow-env', c('pyarrow'), pip = F)
py_config()
system.file(package = "arrow")
reticulate::import_from_path("demo_flight_server", system.file(package = "arrow"))
use_condaenv("arrow-env")
py_config()
use_virtualenv("arrow-env")
py_config()
reticulate::import_from_path("demo_flight_server", system.file(package = "arrow"))
conda_install(envname = 'arrow-env', c('pyarrow'), pip = F, channel = "conda-forge")
reticulate::py_install("pyarrow", envname = "arrow-env", channel = "conda-forge")
conda_binary(conda = "auto")
conda_version(conda = "auto")
conda_python(envname = NULL, conda = "auto")
py_config()
library(arrow)
library(reticulate)
py_config()
virtualenv_create("arrow-env")
install_pyarrow("arrow-env")
use_virtualenv("arrow-env")
a2 <- use_condaenv("arrow-env")
a2
pa <- import("pyarrow")
use_virtualenv
reticulate::py_install("pyarrow", channel = "conda-forge")
conda_remove("pyarrow")
reticulate::py_install("pyarrow", channel = "conda-forge")
pa <- import("pyarrow")
use_virtualenv("r-reticulate")
use_virtualenv("r-reticulate12321")
install_pyarrow("arrow-env")
arrow::install_arrow(verbose = TRUE)
arrow::install_arrow(verbose = TRUE)
library(arrow)
library(reticulate)
library(feather)
arrow::install_arrow(verbose = TRUE)
arrow::install_arrow(verbose = TRUE)
library(arrow)
remove.packages("arrow", lib="~/R/win-library/4.0")
install.packages("C:/Users/flyku/Downloads/arrow_3.0.0.zip", repos = NULL, type = "win.binary", lib="C:/Program Files/Microsoft/R Open/R-4.0.2/library")
install.packages("C:/Users/flyku/Downloads/arrow_3.0.0.zip", repos = NULL, type = "win.binary", lib="C:/Program Files/Microsoft/R Open/R-4.0.2/library")
library(arrow)
library(reticulate)
use_virtualenv("arrow-env2")
reticulate
library(reticulate)
py_config()
Sys.getenv()
library(reticulate)
library(arrow)
virtualenv_create("arrow-env")
install_pyarrow("arrow-env")
n
py_config()
library(tidyverse)
use_virtualenv("arrow-env")
pa <- import("pyarrow")
#Sys.which("python")
use_virtualenv("mye321nv")
use_condaenv("arrow-env")
pa <- import("pyarrow")
reticulate::py_install("pyarrow", channel = "conda-forge")
pa <- import("pyarrow")
library(arrow)
library(reticulate)
library(feather)
pa <- import("pyarrow")
#use_python("C:/Users/flyku/anaconda3/python.exe")
#use_python("/usr/local/bin/python")
py_config()
use_condaenv("arrow-env")
demo_server <- arrow::load_flight_server("demo_flight_server")
install.packages("reticulate")
install.packages("reticulate")
install.packages("reticulate")
install.packages("reticulate")
install.packages("C:/Users/flyku/Downloads/reticulate_1.18.zip", repos = NULL, type = "win.binary", lib="C:/Program Files/Microsoft/R Open/R-4.0.2/library")
library(arrow)
library(reticulate)
conda_remove("pyarrow")
conda_remove("pyarrow")
use_condaenv("arrow-env")
library(arrow)
pa <- import("pyarrow")
os <- import("os")
os$listdir(".")
py_run_string("print(sys.version)")
os.environ['PYTHONPATH'].split(os.pathsep)
os.environ['PYTHONPATH']
os$environ['PYTHONPATH']
library(arrow)
library(reticulate)
library(feather)
pa <- import("pyarrow")
os <- import("os")
os$listdir(".")
os$environ['PYTHONPATH']
os$environ['PYTHONPATH']$split(os.pathsep)
os$environ['PYTHONPATH'].split(os.pathsep)
os$environ['PYTHONPATH']
py_run_string("print(sys.path)")
py_run_string("print(getcwd() )")
py_run_string("print(getcwd())")
py_run_string("getcwd()")
py_run_string("os.getcwd()")
os$getcwd()
arrow::install_arrow(verbose = TRUE)
arrow::install_arrow
sysname <- tolower(Sys.info()[["sysname"]])
sysname
conda <- isTRUE(grepl("conda", R.Version()$platform))
conda
R.Version()$platform
arrow_repos
install.packages("arrow", repos='http://cran.us.r-project.org')
install.packages("arrow", repos = "http://cran.us.r-project.org")
library(arrow)
library(reticulate)
pa <- import("pyarrow")
install.packages("arrow", repos='http://cran.us.r-project.org')
install.packages("arrow", repos='http://cran.us.r-project.org',dependencies = T)
reload_arrow()
library(arrow)
library(reticulate)
pa <- import("pyarrow")
arrow::install_arrow(verbose = TRUE)
library(arrow)
library(reticulate)
flight_connect
library(plumber)
setwd('C:/Users/flyku/Documents/GitHub/iris3-backend/plumber')
#setwd('/var/www/nodejs/iris3-backend/plumber')
plumber::pr("iris3.R") %>% plumber::pr_run(host="0.0.0.0",port=8000)
